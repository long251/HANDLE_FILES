import {
  Button,
  Checkbox,
  DataTable,
  FormLayout,
  Layout,
  LegacyCard,
  Link,
  Modal,
  Page,
  Popover,
} from 'pcs-polaris';
import React, { useCallback, useEffect, useState } from 'react';
import {
  IconAddProduct,
  IconAmerican,
  IconArrowDetail,
  IconArrowDown,
  IconArrowDropExpand,
  IconArrowUp,
  IconDelete,
  IconEdit,
  IconEngland,
  IconGermany,
  IconImportExcel,
  IconJapan,
  IconKorea,
  IconPrintSuccessed,
  IconSuccessed,
} from './IconShippingOrders';
import { showToast } from '../../helpers/toast';
import TitleBreadcrumbs from '../../components/Breadcrumb/TitleBreadcrumb.tsx';
import { IconBack } from '../Ecommerce/IconEcommerce.tsx';
import { useDispatch, useSelector } from 'react-redux';
import { AppState } from '../../store/index.ts';
import { shippingOrdersAction } from '../../store/reducers/shippingOrdersReducer/index.ts';

const CreateShippingOrders = () => {
  const dispatch = useDispatch();
  const shippingOrdersState = useSelector((state: AppState) => state.shippingOrders);
  useEffect(() => {
    dispatch(shippingOrdersAction.fetchRoute({ route: 'US-VN' }));
    dispatch(shippingOrdersAction.fetchChooseAddress());
    dispatch(shippingOrdersAction.fetchProductType());
    dispatch(shippingOrdersAction.fetchAllRoute());
  }, []);
  // Logic Navigation Selected Page
  const [selected, setSelected] = useState(0);
  const handleSelectPageChange = useCallback((selectedTabIndex: number) => setSelected(selectedTabIndex), []);
  //-----------------Create Shipping Orders-------------------------------
  const [activeCountry, setActiveCountry] = useState<string | null>('US-VN');
  const [hoveredCountry, setHoveredCountry] = useState<string | null>(null);
  const handleMouseEnterCountry = (countryName: string) => {
    if (activeCountry !== countryName) {
      setHoveredCountry(countryName);
    }
  };
  const handleMouseLeaveCountry = () => {
    setHoveredCountry(null);
  };
  const handleClickCountry = (countryName: string) => {
    setActiveCountry(countryName);
    dispatch(shippingOrdersAction.fetchRoute({ route: countryName }));
  };
  const [activeAddress, setActiveAddress] = useState<string | null>('5050 NE 112th Ave');
  const [hoveredAddress, setHoveredAddress] = useState<string | null>(null);
  const handleMouseEnterAddress = (address: string) => {
    if (activeAddress !== address) {
      setHoveredAddress(address);
    }
  };
  const handleMouseLeaveAddress = () => {
    setHoveredAddress(null);
  };
  const [expandedAddress, setExpandedAddress] = useState<string | null>(null);
  const handleClickAddress = (address: string) => {
    setActiveAddress(address);
    if (expandedAddress === address) {
      setExpandedAddress(null);
    } else {
      setExpandedAddress(address);
    }
  };
  // Expand delivery Address
  const [activeDeliveyAddress, setActiveDeliveryAddress] = useState(false);
  const toggleModalDeliveryAddress = useCallback(
    () => setActiveDeliveryAddress((activeDeliveyAddress) => !activeDeliveyAddress),
    [],
  );
  const [selectedAddress, setSelectedAddress] = useState<number | null>(null);
  const handleSaveAddress = () => {
    if (selectedAddress) {
      // Tìm địa chỉ được chọn trong shippingOrdersState.address
      const selectedAdd = shippingOrdersState.address.find((add: any) => add.id === selectedAddress);

      if (selectedAdd) {
        // Cập nhật địa chỉ được chọn vào state
        console.log('data choose add', selectedAdd);
        setSelectedAddress(selectedAdd.id);
      }
    }
    toggleModalDeliveryAddress();
  };
  useEffect(() => {
    const defaultAddress = shippingOrdersState.address.find((add: any) => add.active === true);
    if (defaultAddress) {
      setSelectedAddress(defaultAddress.id);
    }
  }, [shippingOrdersState.address]);
  const handleCancel = () => {
    showToast('Hủy tạo đơn thành công', 'success');
  };
  const handleReset = () => {
    handleClickCountry('US-VN');
    handleClickAddress('5050 NE 112th Ave');
    const defaultAddress = shippingOrdersState.address.find((add: any) => add.active === true);
    if (defaultAddress) {
      setSelectedAddress(defaultAddress.id);
    }
  };
  //-----------------------------Create Shipping Orders Tracking Code-------------------------
  const [trackingCodeInput, setTrackingCodeInput] = useState<string>('');
  const [trackingData, setTrackingData] = useState<{ trackingCode: string; services: number[]; packages: number[] }[]>(
    [],
  );
  const [expandedItem, setExpandedItem] = useState<string | null>(null);
  const [expandedItemPackage, setExpandedItemPackage] = useState<number | null>(null);
  const [activePopover, setActivePopover] = useState<string | null>(null);

  const handleTrackingCodeSubmit = () => {
    if (trackingCodeInput.trim() !== '') {
      setTrackingData((prev) => [...prev, { trackingCode: trackingCodeInput, services: [], packages: [1] }]);
      setTrackingCodeInput('');
    }
  };

  const handleKeyPress = (e: React.KeyboardEvent<HTMLInputElement>) => {
    if (e.key === 'Enter') {
      handleTrackingCodeSubmit();
    }
  };

  const handleEdit = (trackingCode: string) => {
    setExpandedItem((prev) => (prev === trackingCode ? null : trackingCode));
  };

  const handleDelete = (index: number) => {
    setTrackingData((prev) => prev.filter((_, idx) => idx !== index));
  };

  const handleAddPackage = (trackingCode: string) => {
    setTrackingData((prev) =>
      prev.map((item) =>
        item.trackingCode === trackingCode ? { ...item, packages: [...item.packages, item.packages.length + 1] } : item,
      ),
    );
  };

  const handleRemovePackage = (trackingCode: string, packageIndex: number) => {
    setTrackingData((prev) =>
      prev.map((item) =>
        item.trackingCode === trackingCode
          ? { ...item, packages: item.packages.filter((_, idx) => idx !== packageIndex) }
          : item,
      ),
    );
  };

  const handleTogglePackageDetails = (packages: number) => {
    setExpandedItemPackage((prev) => (prev === packages ? null : packages));
  };

  const handleTogglePopover = (trackingCode: string) => {
    setActivePopover((active) => (active === trackingCode ? null : trackingCode));
  };

  const handleCheckboxChange = (serviceId: number, trackingCode: string) => {
    setTrackingData((prev) =>
      prev.map((item) =>
        item.trackingCode === trackingCode
          ? {
              ...item,
              services: item.services.includes(serviceId)
                ? item.services.filter((id) => id !== serviceId)
                : [...item.services, serviceId],
            }
          : item,
      ),
    );
  };

  const [fakePackages, setFakePackages] = useState([
    // Các dữ liệu giả đang hiển thị
    { name: 'tên sản phẩm 1', type: 'loại sản phẩm 1', quantity: 1, weight: 'trọng lượng 1', value: 10 },
    { name: 'tên sản phẩm 2', type: 'loại sản phẩm 2', quantity: 2, weight: 'trọng lượng 2', value: 20 },
    // Các mục khác tùy ý
  ]);

  const handleDeleteProduct = (indexToRemove: number) => {
    const updatedPackages = fakePackages.filter((_, index) => index !== indexToRemove);
    setFakePackages(updatedPackages);
  };

  const handleAddProduct = () => {
    const newPackage = { name: 'tên sản phẩm mới', type: 'loại sản phẩm mới', quantity: 0, weight: '0', value: 0 };
    setFakePackages([...fakePackages, newPackage]);
  };

  const handleApplySelection = () => {
    setActivePopover(null);
  };
  const services = [
    { id: 1, name: 'Gom hàng tách vỏ' },
    { id: 2, name: 'Check hàng và chụp ảnh' },
    { id: 3, name: 'Dịch vụ 3' },
    { id: 4, name: 'Dịch vụ 4' },
    { id: 5, name: 'Dịch vụ 5' },
  ];
  const notifySave = () => showToast('Đã lưu vào cơ sở dữ liệu', 'success');
  const handleSave = () => {
    notifySave();
  };
  //------------------------Verify Request-----------------------------
  const fakeDataTrackingList = [
    {
      id: 1,
      trackingCode: 'HMDE000002627243HMDE000002627243',
      weight: '5.6 kg',
      service: 'VAS Included',
      note: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean euismod bibendum',
    },
  ];
  const rows2 = fakeDataTrackingList.map((item) => {
    return [item.id, item.trackingCode, item.weight, item.service, item.note];
  });
  const notify2 = () => showToast('Đã huỷ', 'warning');
  const [isOrderPlaced2, setIsOrderPlaced2] = useState(false);
  const handleCancel2 = () => {
    notify2();
    setIsOrderPlaced2(true);
  };
  //---------------------Verify Request Success---------------------------
  const notifyRequestSuccess = () => showToast('Tạo yêu cầu thành công', 'success');
  const handleClickRequestSuccess = () => {
    notifyRequestSuccess();
  };
  return (
    <div className='Polaris-Custom'>
      <Page
        //@ts-ignore
        title={<TitleBreadcrumbs breadcrumbs={[{ title: 'Tạo yêu cầu vận chuyển', url: '' }]} />}
        primaryAction={
          selected === 1 ? (
            <div className='Icon_Import' onClick={() => handleSelectPageChange(0)}>
              <div>
                <IconBack />
              </div>
              <div className='Create_Order_Font'>Quay lại</div>
            </div>
          ) : null || selected === 2 ? (
            <div className='Icon_Import' onClick={() => handleSelectPageChange(1)}>
              <div>
                <IconBack />
              </div>
              <div className='Create_Order_Font'>Quay lại</div>
            </div>
          ) : null
        }
      >
        <Layout>
          <Layout.Section>
            <LegacyCard>
              <LegacyCard.Section>
                {selected === 0 && (
                  <div>
                    <div style={{ position: 'relative' }}>
                      {/* chọn kho hàng */}
                      <div className='Select_Warehouse'>
                        <div className='Header'>Chọn kho nhận hàng</div>

                        <div className='Region'>
                          <div
                            style={{
                              backgroundColor:
                                activeCountry === 'US-VN' || hoveredCountry === 'US_VN' ? '#EFF1F4' : 'transparent',
                            }}
                            className='Style_Region'
                            onMouseEnter={() => handleMouseEnterCountry('US-VN')}
                            onMouseLeave={handleMouseLeaveCountry}
                            onClick={() => handleClickCountry('US-VN')}
                          >
                            <IconAmerican />
                            Mỹ-Việt Nam
                          </div>
                          <div
                            style={{
                              backgroundColor:
                                activeCountry === 'JP-VN' || hoveredCountry === 'JP-VN' ? '#EFF1F4' : 'transparent',
                            }}
                            className='Style_Region'
                            onMouseEnter={() => handleMouseEnterCountry('JP-VN')}
                            onMouseLeave={handleMouseLeaveCountry}
                            onClick={() => handleClickCountry('JP-VN')}
                          >
                            <IconJapan />
                            Nhật Bản-Việt Nam
                          </div>
                          <div
                            style={{
                              backgroundColor:
                                activeCountry === 'KR-VN' || hoveredCountry === 'KR-VN' ? '#EFF1F4' : 'transparent',
                            }}
                            className='Style_Region'
                            onMouseEnter={() => handleMouseEnterCountry('KR-VN')}
                            onMouseLeave={handleMouseLeaveCountry}
                            onClick={() => handleClickCountry('KR-VN')}
                          >
                            <IconKorea />
                            Hàn Quốc-Việt Nam
                          </div>
                          <div
                            style={{
                              backgroundColor:
                                activeCountry === 'UK-VN' || hoveredCountry === 'UK-VN' ? '#EFF1F4' : 'transparent',
                            }}
                            className='Style_Region'
                            onMouseEnter={() => handleMouseEnterCountry('UK-VN')}
                            onMouseLeave={handleMouseLeaveCountry}
                            onClick={() => handleClickCountry('UK-VN')}
                          >
                            <IconEngland />
                            Anh-Việt Nam
                          </div>
                          <div
                            style={{
                              backgroundColor:
                                activeCountry === 'DE-VN' || hoveredCountry === 'DE-VN' ? '#EFF1F4' : 'transparent',
                            }}
                            className='Style_Region'
                            onMouseEnter={() => handleMouseEnterCountry('DE-VN')}
                            onMouseLeave={handleMouseLeaveCountry}
                            onClick={() => handleClickCountry('DE-VN')}
                          >
                            <IconGermany />
                            Đức-Việt Nam
                          </div>
                        </div>

                        {/* Sổ địa chỉ */}
                        <div className='Address_Book'>
                          {shippingOrdersState.route.map((item: any, index: number) => (
                            <div
                              key={index}
                              style={{
                                backgroundColor:
                                  activeAddress === item.address || hoveredAddress === item.address
                                    ? '#DFE3E9'
                                    : 'transparent',
                              }}
                              className='Style_Address_Book'
                              onMouseEnter={() => handleMouseEnterAddress(item.address)}
                              onMouseLeave={handleMouseLeaveAddress}
                              onClick={() => setActiveAddress(item.address)}
                            >
                              <div style={{ display: 'flex', justifyContent: 'space-between', gap: '20px' }}>
                                <div className='Address'>
                                  Address: <div>{item.address}</div>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'flex-start' }}>
                                  <div className='Style_Button_Expand' onClick={() => handleClickAddress(item.address)}>
                                    {expandedAddress === item.address ? 'Thu gọn' : 'Chi tiết'} <IconArrowDetail />
                                  </div>
                                </div>
                              </div>
                              <div className='Post_Code'>
                                PostCode: <div>{item.postalCode}</div>
                              </div>
                              <div className='Tel'>
                                Tel: <div>{item.phoneNumber}</div>
                              </div>
                              {/* mở rộng chi tiết */}
                              {expandedAddress === item.address && (
                                <div className='ExpandedDetails'>
                                  <div style={{ display: 'flex', gap: '24px' }}>
                                    Prefecture: <div>{item.provinceName}</div>
                                  </div>
                                  <div style={{ display: 'flex', gap: '46px' }}>
                                    District: <div>{item.districtName}</div>
                                  </div>
                                  <div style={{ display: 'flex', gap: '60px' }}>
                                    Ward: <div>{item.wardName}</div>
                                  </div>
                                  <div>{item.accountOther}</div>
                                  <div>{item.accountTransport}</div>
                                </div>
                              )}
                            </div>
                          ))}
                        </div>
                      </div>
                      {/* Địa chỉ nhận hàng */}
                      <div className='Delivery_Address'>
                        <div className='Header'>
                          <div className='Font_Header'>Địa chỉ nhận hàng</div>
                          <div
                            style={{ color: '#0050A6', cursor: 'pointer' }}
                            onClick={() => {
                              toggleModalDeliveryAddress();
                            }}
                          >
                            Sổ địa chỉ <IconArrowDetail />
                          </div>
                        </div>
                        <Modal
                          open={activeDeliveyAddress}
                          large
                          onClose={() => {
                            toggleModalDeliveryAddress();
                          }}
                          title='Chọn địa chỉ nhận hàng'
                          primaryAction={{
                            content: 'Lưu địa chỉ được chọn',
                            onAction: handleSaveAddress,
                          }}
                        >
                          <Modal.Section>
                            <div className='Style_Modal_Choose_Address'>
                              {shippingOrdersState.address.map((add: any, index: number) => (
                                <div
                                  key={index}
                                  className='Item_Choose_Address'
                                  style={{
                                    backgroundColor: selectedAddress === add.id ? '#DFE3E9' : 'transparent',
                                    cursor: 'pointer',
                                  }}
                                  onClick={() => setSelectedAddress(add.id)}
                                >
                                  <div style={{ display: 'flex', gap: '22px' }}>
                                    Người nhận: <div>{add.name}</div>
                                  </div>
                                  <div style={{ display: 'flex', gap: '52px' }}>
                                    Địa chỉ: <div>{add.fullAddress}</div>
                                  </div>
                                  <div style={{ display: 'flex', gap: '12px' }}>
                                    Số điện thoại: <div>{add.phone}</div>
                                  </div>
                                </div>
                              ))}
                            </div>
                          </Modal.Section>
                        </Modal>
                        <div className='Content_Delivery_Address'>
                          {selectedAddress &&
                            (() => {
                              const selectedAdd = shippingOrdersState.address.find(
                                (add: any) => add.id === selectedAddress,
                              );
                              return selectedAdd ? (
                                <>
                                  <div style={{ display: 'flex', gap: '22px' }}>
                                    Người nhận: <div>{selectedAdd.name}</div>
                                  </div>
                                  <div style={{ display: 'flex', gap: '52px' }}>
                                    Địa chỉ: <div>{selectedAdd.fullAddress}</div>
                                  </div>
                                  <div style={{ display: 'flex', gap: '12px' }}>
                                    Số điện thoại: <div>{selectedAdd.phone}</div>
                                  </div>
                                </>
                              ) : null;
                            })()}
                        </div>
                      </div>
                    </div>
                    {/* Active */}
                    <div style={{ position: 'absolute' }}>
                      <div className='Style_Active_Form_Button'>
                        <div style={{ color: '#85C0FF', cursor: 'pointer' }} onClick={handleReset}>
                          Reset
                        </div>
                        <div style={{ display: 'flex', gap: '28px', alignItems: 'center' }}>
                          <div style={{ color: '#FFFFFF', cursor: 'pointer' }} onClick={handleCancel}>
                            <Link url='/don-hang-van-chuyen' removeUnderline monochrome>
                              Hủy
                            </Link>
                          </div>
                          <div className='Active_Button' onClick={() => handleSelectPageChange(1)}>
                            <Button>Tiếp tục</Button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
                {selected === 1 && (
                  <div>
                    <div className='Shipping_Information'>
                      <div className='Header'>
                        <div className='Font'>Thông tin hàng hoá vận chuyển</div>
                        <div style={{ color: '#0050A6', cursor: 'pointer', whiteSpace: 'nowrap' }}>Tải file mẫu</div>
                      </div>

                      <div className='Enter_Tracking_Code'>
                        <div className='Label_Tracking_Code'>
                          <div>Nhập mã tracking</div>
                          <div style={{ flexGrow: '1' }}>
                            <input
                              type='text'
                              className='Input_Tracking'
                              value={trackingCodeInput}
                              onChange={(e) => setTrackingCodeInput(e.target.value)}
                              onKeyPress={handleKeyPress}
                            />
                          </div>
                        </div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>
                          <div className='Button_OK'>
                            <Button onClick={handleTrackingCodeSubmit}>OK</Button>
                          </div>
                          <div className='Button_Import'>
                            <IconImportExcel />
                            Import Excel
                          </div>
                        </div>
                      </div>

                      {trackingData.length > 0 && (
                        <div className='Style_Data_Table_Create_Order'>
                          <div className='Style_Heading_Group'>
                            <div className='Style_Heading' style={{ width: '10%' }}>
                              STT
                            </div>
                            <div className='Style_Heading' style={{ width: '20%' }}>
                              Mã tracking
                            </div>
                            <div className='Style_Heading' style={{ width: '15%' }}>
                              Total
                            </div>
                            <div className='Style_Heading' style={{ width: '20%' }}>
                              Dịch vụ cộng thêm
                            </div>
                            <div className='Style_Heading' style={{ width: '25%' }}>
                              Ghi chú
                            </div>
                            <div className='Style_Heading' style={{ width: '10%' }}>
                              Action
                            </div>
                          </div>
                          {trackingData.map((item, index) => (
                            <React.Fragment key={item.trackingCode}>
                              <div className='Style_Row'>
                                <div className='Style_Cell' style={{ width: '10%' }}>
                                  {index + 1}
                                </div>
                                <div className='Style_Cell' style={{ width: '20%' }}>
                                  <input className='Input_Tracking_Code' value={item.trackingCode} readOnly />
                                </div>
                                <div className='Style_Cell' style={{ width: '15%' }}>
                                  <div
                                    className='Style_Total'
                                    style={{
                                      fontWeight: '700',
                                      backgroundColor: '#EFF1F4',
                                      padding: '12px 16px',
                                      display: 'inline-flex',
                                    }}
                                  >
                                    {item.packages.length} Packages | kg
                                  </div>
                                </div>
                                <div className='Style_Cell' style={{ width: '20%' }}>
                                  <div
                                    className='Style_Additional_Services'
                                    style={{
                                      border: '1px solid #D1D5DB',
                                      borderRadius: '4px',
                                      display: 'flex',
                                      gap: '20px',
                                      padding: '12px',
                                      justifyContent: 'space-between',
                                      alignItems: 'center',
                                      maxWidth: '400px',
                                      verticalAlign: 'center',
                                    }}
                                  >
                                    {item.services.length > 0 ? (
                                      <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                                        {services
                                          .filter((service) => item.services.includes(service.id))
                                          .map((service, index) => (
                                            <div key={index} className='Style_Service'>
                                              {service.name}
                                            </div>
                                          ))}
                                      </div>
                                    ) : (
                                      <div>Chọn dịch vụ</div>
                                    )}
                                    <div className='Style_Popover_Button'>
                                      <Popover
                                        active={activePopover === item.trackingCode}
                                        activator={
                                          <Button
                                            icon={IconArrowDropExpand}
                                            onClick={() => handleTogglePopover(item.trackingCode)}
                                          />
                                        }
                                        onClose={() => setActivePopover(null)}
                                        preferredAlignment='right'
                                        preferredPosition='below'
                                      >
                                        <div className='Popover_Content'>
                                          <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                                            {services.map((service) => (
                                              <Checkbox
                                                key={service.id}
                                                label={service.name}
                                                checked={item.services.includes(service.id)}
                                                onChange={() => handleCheckboxChange(service.id, item.trackingCode)}
                                              />
                                            ))}
                                          </div>
                                          <div
                                            style={{ display: 'flex', justifyContent: 'flex-start', marginTop: '12px' }}
                                          >
                                            <Button onClick={handleApplySelection}>OK</Button>
                                          </div>
                                        </div>
                                      </Popover>
                                    </div>
                                  </div>
                                </div>
                                <div className='Style_Cell' style={{ width: '25%' }}>
                                  <input className='Input_Tracking_Code'></input>
                                </div>
                                <div className='Style_Cell' style={{ width: '10%' }}>
                                  <div style={{ display: 'flex', gap: '16px', justifyContent: 'center' }}>
                                    <div
                                      className='Style_Icon_Edit_Delete'
                                      onClick={() => handleEdit(item.trackingCode)}
                                    >
                                      <IconEdit />
                                    </div>
                                    <div className='Style_Icon_Edit_Delete' onClick={() => handleDelete(index)}>
                                      <IconDelete />
                                    </div>
                                  </div>
                                </div>
                              </div>

                              {expandedItem === item.trackingCode && (
                                <div
                                  style={{
                                    margin: '16px 0',
                                    border: '1px dashed #D1D5DB',
                                    width: '100%',
                                  }}
                                >
                                  <div
                                    style={{
                                      display: 'flex',
                                      padding: '16px 20px',
                                      justifyContent: 'space-between',
                                      backgroundColor: '#0B3558',
                                      color: '#FFFFFF',
                                    }}
                                  >
                                    <div style={{ display: 'flex', gap: '16px' }}>
                                      Tracking No. <div>{item.trackingCode}</div>
                                    </div>
                                    <div>{item.packages.length} pkg | kg</div>
                                  </div>

                                  {item.packages.map((pkg, index) => (
                                    <div key={index} className='Package_Item'>
                                      <div
                                        style={{
                                          display: 'flex',
                                          borderBottom: '1px dashed #D1D5DB',
                                          justifyContent: 'space-between',
                                          borderTop: '1px dashed #D1D5DB',
                                        }}
                                      >
                                        <div style={{ display: 'flex' }}>
                                          <div
                                            style={{
                                              borderRight: '1px dashed #D1D5DB',
                                              padding: '20px',
                                              borderLeft: 'unset',
                                              display: 'flex',
                                              alignItems: 'center',
                                            }}
                                          >
                                            <div
                                              className='Icon_Arrow_Expand'
                                              onClick={() => handleTogglePackageDetails(index)}
                                            >
                                              {expandedItemPackage === index ? <IconArrowUp /> : <IconArrowDown />}
                                            </div>
                                          </div>
                                          <div
                                            style={{
                                              padding: '20px',
                                              display: 'flex',
                                              alignItems: 'center',
                                              fontWeight: '700',
                                            }}
                                          >
                                            Package #{index + 1}
                                          </div>
                                        </div>
                                        <div style={{ padding: '20px' }}>
                                          {index === item.packages.length - 1 ? (
                                            <Button onClick={() => handleAddPackage(item.trackingCode)}>
                                              Thêm Package
                                            </Button>
                                          ) : (
                                            <Button onClick={() => handleRemovePackage(item.trackingCode, index)}>
                                              Xóa kiện hàng
                                            </Button>
                                          )}
                                        </div>
                                      </div>
                                      {expandedItemPackage === index && (
                                        <table className='Table_Package_Detail'>
                                          <tbody>
                                            <tr>
                                              <td
                                                rowSpan={fakePackages.length + 1}
                                                style={{ width: '60px', borderLeft: 'unset' }}
                                              ></td>
                                              <td>#</td>
                                              <td>Tên sản phẩm</td>
                                              <td>Loại sản phẩm</td>
                                              <td>Số lượng</td>
                                              <td>Trọng lượng (kg)</td>
                                              <td>Giá trị</td>
                                              <td>{' '}</td>
                                            </tr>
                                            {fakePackages.map((product: any, index: number) => (
                                              <tr key={index}>
                                                <td>{index + 1}</td>
                                                <td
                                                  style={{
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                  }}
                                                >
                                                  <input
                                                    type='text'
                                                    defaultValue={product.name}
                                                    className='Style_Input'
                                                  />
                                                </td>
                                                <td>
                                                  <input
                                                    type='text'
                                                    defaultValue={product.type}
                                                    className='Style_Input'
                                                  />
                                                </td>
                                                <td>
                                                  <input
                                                    type='text'
                                                    defaultValue={product.quantity}
                                                    className='Style_Input'
                                                  />
                                                </td>
                                                <td>
                                                  <input
                                                    type='text'
                                                    defaultValue={product.weight}
                                                    className='Style_Input'
                                                  />
                                                </td>
                                                <td>
                                                  <div
                                                    style={{
                                                      display: 'flex',
                                                      alignItems: 'center',
                                                      justifyContent: 'center',
                                                    }}
                                                  >
                                                    <input
                                                      type='text'
                                                      defaultValue={product.value}
                                                      className='Style_Input'
                                                      style={{ width: '50%' }}
                                                    />
                                                    <div
                                                      style={{
                                                        padding: '11px 18px',
                                                        border: '1px solid #D1D5DB',
                                                        borderRadius: '0 4px 4px 0',
                                                        borderLeft: 'none',
                                                      }}
                                                    >
                                                      $
                                                    </div>
                                                  </div>
                                                </td>
                                                <td>
                                                  <div
                                                    style={{
                                                      display: 'flex',
                                                      gap: '8px',
                                                      alignItems: 'center',
                                                      justifyContent: 'center',
                                                    }}
                                                  >
                                                    <div
                                                      className='Style_Icon_Edit_Delete'
                                                      onClick={() => handleDeleteProduct(index)}
                                                    >
                                                      <IconDelete />
                                                    </div>
                                                    <div className='Style_Icon_Edit_Delete' onClick={handleAddProduct}>
                                                      <IconAddProduct />
                                                    </div>
                                                  </div>
                                                </td>
                                              </tr>
                                            ))}
          
                                              <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '8px' }}>
                                                <Button>Cancel</Button>
                                                <Button>Save</Button>
                                              </div>
                       
                                          </tbody>
                                        </table>
                                      )}
                                    </div>
                                  ))}
                                </div>
                              )}
                            </React.Fragment>
                          ))}
                        </div>
                      )}
                    </div>

                    <div style={{ position: 'absolute' }}>
                      <div className='Create_Input_Tracking_Code'>
                        <div style={{ color: '#85C0FF', whiteSpace: 'nowrap' }}>{trackingData.length} Tracking</div>
                        <div style={{ display: 'flex', gap: '20px', alignItems: 'center' }}>
                          <div style={{ color: '#FFFFFF', cursor: 'pointer' }} onClick={handleSave}>
                            Lưu
                          </div>
                          <div className='Active_Button' onClick={() => handleSelectPageChange(2)}>
                            <Button>Tiếp tục</Button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {selected === 2 && (
                  <div>
                    <FormLayout>
                      <FormLayout.Group>
                        <table className='Info_Table_Shipping_Orders'>
                          <thead>
                            <tr>
                              <th colSpan={2}>Thông tin vận chuyển</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td style={{ width: '30%' }}>Tuyến vận chuyển</td>
                              <td style={{ width: '70%' }}>{}</td>
                            </tr>
                            <tr>
                              <td>Kho nhận hàng</td>
                              <td>Kho Oregon</td>
                            </tr>
                          </tbody>
                        </table>

                        <table className='Info_Table_Shipping_Orders'>
                          <thead>
                            <tr>
                              <th colSpan={2}>Thông tin giao hàng</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td style={{ width: '30%' }}>Người nhận</td>
                              <td style={{ width: '70%' }}>Lê Tuấn Anh - 0974497237</td>
                            </tr>
                            <tr>
                              <td>Địa chỉ</td>
                              <td>Số 17 Quang Tiến, P. Đại Mỗ, Q. Nam Từ Liêm, TP. Hà Nội</td>
                            </tr>
                          </tbody>
                        </table>
                      </FormLayout.Group>
                    </FormLayout>
                    {/* danh sách tracking */}
                    <div className='Data_Table_Verify_Request'>
                      <DataTable
                        columnContentTypes={['text', 'text', 'text', 'text', 'text']}
                        headings={['Danh sách tracking', '', '', '', '']}
                        rows={rows2}
                      />
                    </div>
                    {/* Active */}
                    {!isOrderPlaced2 && (
                      <div style={{ position: 'absolute' }}>
                        <div className='Verify_Request'>
                          <div style={{ color: '#85C0FF' }}>6 Tracking</div>
                          <div style={{ display: 'flex', gap: '28px', alignItems: 'center' }}>
                            <div style={{ color: '#FFFFFF', cursor: 'pointer' }} onClick={handleCancel2}>
                              Huỷ
                            </div>
                            <div className='Active_Button' onClick={() => handleSelectPageChange(3)}>
                              <Button>Gửi yêu cầu</Button>
                            </div>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                )}
                {selected === 3 && (
                  <div className='Verify_Reuquest_Successed'>
                    {/* trạng thái thành công */}
                    <div className='Icon_Successed'>
                      <div>
                        <IconSuccessed />
                      </div>
                      <div className='Title_Verify_Request'>
                        <div className='Font_Title'>Quý khách đã tạo yêu cầu thành công</div>
                        <div>(11:25 - Thứ 6, ngày 12/08/2022)</div>
                      </div>
                    </div>

                    {/* Danh sách tracking */}
                    <div style={{ position: 'relative', marginTop: '68px' }}>
                      <div className='Data_Table_Verify_Request'>
                        <DataTable
                          columnContentTypes={['text', 'text', 'text', 'text', 'text']}
                          headings={['Danh sách tracking', '', '', '', '']}
                          rows={rows2}
                        />
                      </div>

                      <div className='Icon_Print_Information'>
                        <IconPrintSuccessed /> In Thông tin
                      </div>
                    </div>

                    {/* Quản lý & tạo yêu cầu */}
                    <div
                      style={{
                        display: 'flex',
                        justifyContent: 'center',
                        alignItems: 'center',
                        gap: '20px',
                        marginTop: '48px',
                        flexWrap: 'wrap',
                      }}
                    >
                      <div className='Button_Order_Management'>
                        <Button url='/don-hang-van-chuyen' monochrome removeUnderline>
                          Quản lý đơn hàng
                        </Button>
                      </div>
                      <div className='Button_Create_Request' onClick={handleClickRequestSuccess}>
                        <Button>Tạo yêu cầu đơn mới</Button>
                      </div>
                    </div>
                  </div>
                )}
              </LegacyCard.Section>
            </LegacyCard>
          </Layout.Section>
        </Layout>
      </Page>
    </div>
  );
};

export default CreateShippingOrders;
